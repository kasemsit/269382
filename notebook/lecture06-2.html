

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>8. การตัดสินใจด้วยต้นไม้ &#8212; 269382 Data Analytics for Non-IT</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebook/lecture06-2';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="9. ปัญหาการจัดกลุ่มลูกค้า" href="lecture07.html" />
    <link rel="prev" title="7. การแปลงข้อมูล categorical และ ordinal ให้เป็นตัวเลข" href="lecture06-1.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="ค้นหาคำในเล่ม..."
         aria-label="ค้นหาคำในเล่ม..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="269382 Data Analytics for Non-IT - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="269382 Data Analytics for Non-IT - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    269382 Data Analytics for Non-IT
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">เนื้อหา</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lecture01.html">1. สำรวจชุดข้อมูลทิป</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture02.html">2. สำรวจชุดข้อมูลขายของออนไลน์</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture03.html">3. สำรวจชุดข้อมูลดอกไอริส</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture04-1.html">4. การทำนายความยาวกลีบเลี้ยงด้วยชุดข้อมูลดอกไอริส</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture04-2.html">5. สมมติฐานของ Linear regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture05.html">6. ปัญหาการจำแนกประเภทดอกไอริส</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture06-1.html">7. การแปลงข้อมูล categorical และ ordinal ให้เป็นตัวเลข</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">8. การตัดสินใจด้วยต้นไม้</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture07.html">9. ปัญหาการจัดกลุ่มลูกค้า</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">ภาคผนวก</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="appendix01_gdrive.html">การใช้ Google Drive กับ Google Colab</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/kasemsit/269382/blob/master/notebook/lecture06-2.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebook/lecture06-2.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>การตัดสินใจด้วยต้นไม้</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> สารบัญ </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">8.1. เตรียมข้อมูลให้พร้อม</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decision-tree">8.2. เทรนโมเดล Decision tree</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">8.3. ประเมินประสิทธิภาพของโมเดล</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">8.4. การแปลผลการติดสินใจ</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overfit-underfit">8.5. ปัญหา overfit และ underfit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gridsearchcv">8.6. ลองค่าต่าง ๆ ด้วย <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1><span class="section-number">8. </span>การตัดสินใจด้วยต้นไม้<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h1>
<p><strong>จุดประสงค์การเรียนรู้</strong></p>
<ol class="arabic simple">
<li><p>รู้จักวิธีการ Decision tree และทราบว่ามีวิธีการตัดสินใจต่างจาก Linear model (Linear/Logistic Regression) ในคาบที่ผ่านมาอย่างไร</p></li>
<li><p>เทรนและทดสอบ Decision tree ได้</p></li>
<li><p>ตระหนักถึงปัญหา overfit และ underfit ของโมเดลกับข้อมูล</p></li>
<li><p>สามารถใช้ <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> ในการลองเทรนโมเดลที่การตั้งค่าต่าง ๆ</p></li>
</ol>
<p>ในบทนี้ เราจะยังคงใช้ชุดข้อมูลเดิมจากบทที่ผ่านมา คือ <a class="reference external" href="https://archive.ics.uci.edu/dataset/19/car+evaluation">Car Evaluation</a> ซึ่งเป็นชุดข้อมูลเกี่ยวกับการประเมินค่ารถ</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">pip</span> install ucimlrepo
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: ucimlrepo in /home/kasemsit/269382/.venv/lib/python3.10/site-packages (0.0.3)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">[</span><span class=" -Color -Color-Blue">notice</span><span class=" -Color -Color-Bold">]</span> A new release of pip is available: <span class=" -Color -Color-Red">23.3.2</span> -&gt; <span class=" -Color -Color-Green">24.0</span>
<span class=" -Color -Color-Bold">[</span><span class=" -Color -Color-Blue">notice</span><span class=" -Color -Color-Bold">]</span> To update, run: <span class=" -Color -Color-Green">pip install --upgrade pip</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ucimlrepo</span> <span class="kn">import</span> <span class="n">fetch_ucirepo</span>
<span class="n">car_evaluation</span> <span class="o">=</span> <span class="n">fetch_ucirepo</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">19</span><span class="p">)</span>   <span class="c1"># fetch dataset</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">car_evaluation</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">features</span>        <span class="c1"># data (as pandas dataframes)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">car_evaluation</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">targets</span>
</pre></div>
</div>
</div>
</div>
<p>ชุดข้อมูล Car Evaluation มีตัวแปรดังต่อไปนี้</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>คอลัมน์</p></th>
<th class="head text-left"><p>ความหมาย</p></th>
<th class="head text-left"><p>ค่าที่เป็นไปได้</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>buying</p></td>
<td class="text-left"><p>ราคาซื้อ</p></td>
<td class="text-left"><p>vhigh, high, med, low</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>maint</p></td>
<td class="text-left"><p>ค่าบำรุงรักษา</p></td>
<td class="text-left"><p>vhigh, high, med, low</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>doors</p></td>
<td class="text-left"><p>จำนวนประตูรถ</p></td>
<td class="text-left"><p>2, 3, 4, 5more</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>persons</p></td>
<td class="text-left"><p>จำนวนผู้โดยสาร</p></td>
<td class="text-left"><p>2, 4, more</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>lug_boot</p></td>
<td class="text-left"><p>ความจุท้ายรถ</p></td>
<td class="text-left"><p>small, med, big</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>safety</p></td>
<td class="text-left"><p>ประมาณการความปลอดภัยของรถ</p></td>
<td class="text-left"><p>low, med, high</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>class</p></td>
<td class="text-left"><p>ระดับการประเมินซึ่งแสดงถึง Car’s Acceptability</p></td>
<td class="text-left"><p>unacc, acc, good, vgood</p></td>
</tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>class
unacc    1210
acc       384
good       69
vgood      65
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<section id="id2">
<h2><span class="section-number">8.1. </span>เตรียมข้อมูลให้พร้อม<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h2>
<p>ก่อนอื่น แบ่งข้อมูล train/test โดยให้สัดส่วน 30% เป็นของข้อมูล test</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>จากนั้น แปลงทุกคอลัมน์ของตัวแปรต้นให้เป็นตัวเลข ด้วย <code class="docutils literal notranslate"><span class="pre">OrdinalEncoder</span></code> เนื่องจากทุกคอลัมน์เป็นค่าที่มีลำดับ โดยวิธีการใช้ <code class="docutils literal notranslate"><span class="pre">OrdinalEncoder</span></code> เหมือนกับในบทที่ผ่านมา</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OrdinalEncoder</span>

<span class="nb">ord</span> <span class="o">=</span> <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span>
     <span class="p">[[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="s1">&#39;med&#39;</span><span class="p">,</span><span class="s1">&#39;high&#39;</span><span class="p">,</span><span class="s1">&#39;vhigh&#39;</span><span class="p">],</span>  <span class="c1"># ลำดับของค่าในคอลัมน์ buying</span>
      <span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="s1">&#39;med&#39;</span><span class="p">,</span><span class="s1">&#39;high&#39;</span><span class="p">,</span><span class="s1">&#39;vhigh&#39;</span><span class="p">],</span>  <span class="c1"># ลำดับของค่าในคอลัมน์ maint</span>
      <span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;5more&#39;</span><span class="p">],</span>      <span class="c1"># ลำดับของค่าในคอลัมน์ doors</span>
      <span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;more&#39;</span><span class="p">],</span>            <span class="c1"># ลำดับของค่าในคอลัมน์ persons</span>
      <span class="p">[</span><span class="s1">&#39;small&#39;</span><span class="p">,</span><span class="s1">&#39;med&#39;</span><span class="p">,</span><span class="s1">&#39;big&#39;</span><span class="p">],</span>         <span class="c1"># ลำดับของค่าในคอลัมน์ lug_boot</span>
      <span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="s1">&#39;med&#39;</span><span class="p">,</span><span class="s1">&#39;high&#39;</span><span class="p">]]</span>          <span class="c1"># ลำดับของค่าในคอลัมน์ safety</span>
<span class="p">)</span>
<span class="nb">ord</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="s1">&#39;pandas&#39;</span><span class="p">)</span>
<span class="n">X_train_new</span> <span class="o">=</span> <span class="nb">ord</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_train_new</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>buying</th>
      <th>maint</th>
      <th>doors</th>
      <th>persons</th>
      <th>lug_boot</th>
      <th>safety</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1468</th>
      <td>0.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>152</th>
      <td>3.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>1119</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1252</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>556</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1122</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1346</th>
      <td>0.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>1406</th>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>1389</th>
      <td>0.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1534</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
<p>1209 rows × 6 columns</p>
</div></div></div>
</div>
</section>
<section id="decision-tree">
<h2><span class="section-number">8.2. </span>เทรนโมเดล Decision tree<a class="headerlink" href="#decision-tree" title="Permalink to this heading">#</a></h2>
<p>ก่อนอื่น ให้ศึกษาหลักการเบื้องต้นของโมเดลต้นไม้ตัดสินใจ (Decision tree) จาก <a class="reference external" href="https://docs.google.com/presentation/d/1qCZki7tNQGmRlzqnQchn2i2f5ED2gRtw3mObhiRy3yU/edit?usp=sharing">Slides (คลิกเพื่อเปิด)</a> โดยในส่วนของการเขียนโค้ด เราจะใช้ <code class="docutils literal notranslate"><span class="pre">DecisionTreeClassifier</span></code> (<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.tree.DecisionTreeClassifier.html">คู่มือ</a>) ของ Scikit-learn ซึ่งมีรูปแบบใช้งานไม่ต่างจาก <code class="docutils literal notranslate"><span class="pre">LinearRegression/LogisticRegression</span></code> มากนัก ยกเว้นโมเดลจะมีการกำหนดค่าพารามิเตอร์ที่แตกต่างกัน</p>
<p>สำหรับรูปแบบการใช้งาน และพารามิเตอร์ที่กำหนดได้ในเบื้องต้น เป็นดังนี้</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span>
            <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;gini&#39;</span> <span class="n">หรือ</span> <span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
            <span class="n">max_depth</span><span class="o">=</span><span class="n">จำนวนชั้นการตัดสินใจ</span><span class="p">,</span>
            <span class="n">min_samples_split</span><span class="o">=</span><span class="n">จำนวนจุดข้อมูลขั้นต่ำที่จะทำการแตกกิ่ง</span><span class="p">,</span>
            <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">จำนวนจุดข้อมูลขั้นต่ำที่ปลายกิ่งต้องมี</span><span class="p">,</span>
            <span class="n">random_state</span><span class="o">=</span><span class="n">ค่าซีดล็อคผลการสุ่มถ้ามี</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span>
                            <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                            <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                            <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="n">dt</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_new</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>DecisionTreeClassifier(max_depth=3, random_state=123)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;DecisionTreeClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.tree.DecisionTreeClassifier.html">?<span>Documentation for DecisionTreeClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>DecisionTreeClassifier(max_depth=3, random_state=123)</pre></div> </div></div></div></div></div></div>
</div>
</section>
<section id="id3">
<h2><span class="section-number">8.3. </span>ประเมินประสิทธิภาพของโมเดล<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train_new</span><span class="p">)</span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Accuracy on the training set = </span><span class="si">{</span><span class="n">acc</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Accuracy on the training set = 0.8147
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_test_new</span> <span class="o">=</span> <span class="nb">ord</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_new</span><span class="p">)</span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Accuracy on the test set = </span><span class="si">{</span><span class="n">acc</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Accuracy on the test set = 0.7842
</pre></div>
</div>
</div>
</div>
<p>หากจะลองป้อนข้อมูล 1 example เข้าไป เพื่อดูว่าโมเดลทำนายอะไรออกมา ก็ทำได้ ยกตัวอย่างเช่น ป้อน</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>‘buying’</p></th>
<th class="head text-left"><p>‘maint’</p></th>
<th class="head text-left"><p>‘doors’</p></th>
<th class="head text-left"><p>‘persons’</p></th>
<th class="head text-left"><p>‘lug_boot’</p></th>
<th class="head text-left"><p>‘safety’</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>‘low’</p></td>
<td class="text-left"><p>‘vhigh’</p></td>
<td class="text-left"><p>‘2’</p></td>
<td class="text-left"><p>‘4’</p></td>
<td class="text-left"><p>‘small’</p></td>
<td class="text-left"><p>‘low’</p></td>
</tr>
</tbody>
</table>
<p>จะพบว่าทำนาย <code class="docutils literal notranslate"><span class="pre">unacc</span></code> ออกมาดังโค้ดด้านล่างนี้</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">sample_input</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span>   <span class="s1">&#39;vhigh&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span>    <span class="s1">&#39;4&#39;</span><span class="p">,</span>      <span class="s1">&#39;small&#39;</span><span class="p">,</span>   <span class="s1">&#39;low&#39;</span><span class="p">]],</span>
                     <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;buying&#39;</span><span class="p">,</span><span class="s1">&#39;maint&#39;</span><span class="p">,</span> <span class="s1">&#39;doors&#39;</span><span class="p">,</span><span class="s1">&#39;persons&#39;</span><span class="p">,</span><span class="s1">&#39;lug_boot&#39;</span><span class="p">,</span><span class="s1">&#39;safety&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Before OrdinalEncoder:</span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="n">sample_input</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">sample_input</span> <span class="o">=</span> <span class="nb">ord</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sample_input</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Input to the model:</span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="n">sample_input</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sample_input</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Model prediction:</span><span class="se">\n</span><span class="si">{</span><span class="n">prediction</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Before OrdinalEncoder:
   buying  maint doors persons lug_boot safety
0    low  vhigh     2       4    small    low
Input to the model:
    buying  maint  doors  persons  lug_boot  safety
0     0.0    3.0    0.0      1.0       0.0     0.0
Model prediction:
[&#39;unacc&#39;]
</pre></div>
</div>
</div>
</div>
<p>ผลดังกล่าว สอดคล้องกับกราฟจาก <code class="docutils literal notranslate"><span class="pre">plot_tree</span></code> ในห้วข้อถัดไปหรือไม่?</p>
</section>
<section id="id4">
<h2><span class="section-number">8.4. </span>การแปลผลการติดสินใจ<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h2>
<p>โมเดล Decision tree ตัดสินใจโดยการหากฎ IF/ELSE จากข้อมูล  ที่สามารถแบ่งข้อมูลได้ดีที่สุด เราสามารถตรวจสอบกฎดังกล่าว ที่ได้จากการเทรน ดังนี้</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">plot_tree</span>
<span class="n">feature_names</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">feature_names_in_</span>  <span class="c1"># ชื่อของคอลัมน์ที่นำมาเทรนโมเดล</span>
<span class="n">plot_tree</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span>   <span class="c1"># ตัว DecisionTreeClassifier ที่เทรนแล้ว</span>
          <span class="n">filled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># ระบายสีลงในแผนภาพ</span>
          <span class="n">feature_names</span><span class="o">=</span><span class="n">feature_names</span> <span class="c1"># ใส่ชื่อคุณลักษณะหรือคอลัมน์ของข้อมูลที่ใช้ตัดสินใจ)</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/efbe7f57bc18b60ff8a5557c1933aecc8663dbdaee7fc8ca33440389669a738b.png" src="../_images/efbe7f57bc18b60ff8a5557c1933aecc8663dbdaee7fc8ca33440389669a738b.png" />
</div>
</div>
<p>จากกราฟ ลำดับการตัดสินใจในแต่ละ node ว่าจะเริ่มตัดสินใจจากตัวแปรใดบ้าง รวมถึงตัดสินใจแบ่งด้วยค่าเท่าไรนั้น เช่น <code class="docutils literal notranslate"><span class="pre">persons&lt;=0.5</span></code> หรือ  <code class="docutils literal notranslate"><span class="pre">maint&lt;=2.5</span></code> เป็นสิ่งที่เรียนรู้จากข้อมูล training</p>
<p><strong>วิธีอ่านกราฟ:</strong></p>
<p>ลูกศรที่ออกจากแต่ละ node ของกราฟ <em>หากชี้ซ้าย แปลว่า จริง และหากชี้ขวา แปลว่า เท็จ</em></p>
<p>ในแต่ละโหนดของกราฟ</p>
<ol class="arabic simple">
<li><p>คอลัมน์ที่จะใช้ในการตัดสินใจที่ node นั้น ๆ เช่น <code class="docutils literal notranslate"><span class="pre">persons&lt;=0.5</span></code></p></li>
<li><p>สถานะของค่า impurity ที่ node นั้น ๆ เช่น <code class="docutils literal notranslate"><span class="pre">gini=0.459</span></code> (เป็นค่าก่อนการใช้กฎการตัดสินใจจากข้อ 1.)</p></li>
<li><p>จำนวนข้อมูลทั้งหมดที่ node นั้น ๆ</p></li>
<li><p>จำนวนข้อมูลจากข้อ 3 แจกแจงจำนวนตาม class ใน node นั้น ๆ ตามลำดับ <code class="docutils literal notranslate"><span class="pre">['acc',</span> <span class="pre">'good',</span> <span class="pre">'unacc',</span> <span class="pre">'vgood']</span></code> (ดูลำดับจาก <code class="docutils literal notranslate"><span class="pre">dt.classes_</span></code>)</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dt</span><span class="o">.</span><span class="n">classes_</span>  <span class="c1"># ค่า value= ในกราฟ จะเรียงลำดับตาม dt.classes_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;acc&#39;, &#39;good&#39;, &#39;unacc&#39;, &#39;vgood&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
</section>
<section id="overfit-underfit">
<h2><span class="section-number">8.5. </span>ปัญหา overfit และ underfit<a class="headerlink" href="#overfit-underfit" title="Permalink to this heading">#</a></h2>
<p>ปัญหาที่ Decision tree มักผจญเสมอ ก็คือปัญหา overfit และ underfit อันที่จริงปัญหานี้ เป็นปัญหาสำคัญที่พบได้กับทุก<strong>โมเดล ที่สามารถสร้างรูปแบบการตัดสินใจที่ซับซ้อนมากเกินไปหรือน้อยเกินไป</strong> ดังนั้น เราลองมาทำความเข้าใจว่า มันคือปัญหาอะไรกันแน่</p>
<p>เพื่อให้เห็นภาพ เราจะใช้โค้ดตั้งต้นเดิม แต่เปลี่ยนไปใช้ชุดข้อมูล <a class="reference external" href="https://archive.ics.uci.edu/dataset/602/dry+bean+dataset">Dry Bean</a> (ชุดข้อมูลจำแนกพันธุ์ถั่วแห้ง) ซึ่งมีความยากกว่าชุดข้อมูล Car Evaluation โดยตัด <code class="docutils literal notranslate"><span class="pre">OrdinalEncoder</span></code> ทิ้งไป เพราะชุดข้อมูล Dry Bean เป็นตัวเลขทั้งหมดอยู่แล้ว</p>
<p>สำหรับชุดข้อมูล Dry Bean เราจะมีข้อมูลถั่วทั้งหมด 13,611 เมล็ด ซึ่งแต่ละเมล็ดมี 16 คุณลักษณะ เพื่อใช้จำแนกชนิดถั่วออกเป็น 7 ประเภท</p>
<p>นักศึกษาไม่จำเป็นต้องทำความเข้าใจว่าแต่ละคอลัมน์ของชุดข้อมูล Dry Bean คืออะไร แต่ให้ลองรันโค้ดด้านล่างนี้ และทดสอบปรับค่า <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> ที่ค่าต่าง ๆ เช่น</p>
<p><code class="docutils literal notranslate"><span class="pre">max_depth</span> <span class="pre">=</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">4,</span> <span class="pre">...,</span> <span class="pre">10,</span> <span class="pre">100</span></code></p>
<p>แล้วให้สังเกตุค่า Accuracy ของ training set เทียบกับ test set</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># โค้ดในบล๊อคนี้ เป็นโค้ดที่สมบูรณ์ในตัว</span>
<span class="o">%</span><span class="k">reset</span> -f
<span class="kn">from</span> <span class="nn">ucimlrepo</span> <span class="kn">import</span> <span class="n">fetch_ucirepo</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">fetch_ucirepo</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">602</span><span class="p">)</span>   <span class="c1"># fetch dataset</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">features</span>        <span class="c1"># data (as pandas dataframes)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">targets</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="n">dt</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span>
                            <span class="n">max_depth</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>   <span class="c1">### ลองแก้ตรงนี้</span>
                            <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                            <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="c1"># เริ่มเทรน</span>
<span class="n">dt</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Training set</span>
<span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">acc_train</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>

<span class="c1"># Test set</span>
<span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">acc_test</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>

<span class="c1"># Print accuracy</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Accuracy: train = </span><span class="si">{</span><span class="n">acc_train</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, test = </span><span class="si">{</span><span class="n">acc_test</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<figure>
<img src="https://raw.githubusercontent.com/kasemsit/269382/main/fig/decision_tree_max_depth.svg" width=100%>
<figcaption>กราฟเปรียบเทียบค่า accuracy ของชุดข้อมูล train และ test ที่ค่า max_depth ค่าต่าง ๆ ของโมเดล</figcaption>
</figure>
<p>จากกราฟ จะสามารถสังเกตุผลของการปรับค่า <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> ดังนี้</p>
<ol class="arabic simple">
<li><p>ที่ค่า <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> น้อยมาก ๆ เช่น <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> ได้ accuracy ของข้อมูล train และ test เท่ากับ 82.5% และ 82.2% ตามลำดับ โดยที่ค่าประสิทธิภาพนี้ต่ำเมื่อเทียบกับส่วนทางขวาของกราฟ สถานการณ์นี้บ่งบอกว่าเกิดปัญหา underfit เพราะจำนวนชั้นของกฎต้นไม้น้อยเกินไป</p></li>
</ol>
<ul class="simple">
<li><p><strong>underfit</strong> = โมเดลไม่ซับซ้อนพอที่จะจดจำลักษณะของข้อมูลที่ซับซ้อนได้ (= poor generaliztion)</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>ที่ <code class="docutils literal notranslate"><span class="pre">max_depth=25</span></code> มีค่า accuracy ของ train ประมาณ 100% หมายความว่าโมเดลจำข้อมูล train ได้ทุกตัว แต่กลับได้ accuracy ของข้อมูล test เพียง 89.9% ความห่างกันอย่างมากระหว่างผลของ training set กับ test set บ่งบอกถึงปัญหา overfit เพราะจำนวนชั้นของกฎต้นไม้มากเกินไป</p></li>
</ol>
<ul class="simple">
<li><p><strong>overfit</strong> = โมเดลซับซ้อนมากเกินไป จนจดจำข้อมูลที่ใช้ฝึกสอนได้ดี แต่กลับนำความรู้ไปใช้กับข้อมูลที่ไม่เคยเห็นได้แย่ (= poor generaliztion)</p></li>
</ul>
<ol class="arabic simple" start="3">
<li><p>ที่ค่า <code class="docutils literal notranslate"><span class="pre">max_depth=8</span></code> ได้ค่า accuracy ของ test set สูงสุดเท่าที่เป็นไปได้คือ 90.9% แม้ว่า training set จะได้เพียง 94.1%</p></li>
</ol>
<blockquote>
<div><p><strong>Note:</strong> ลักษณะของกราฟข้างต้น เรียกว่า <strong>Bias-variance tradeoff</strong> ซึ่งเป็นความกล้ำกลืนที่ต้องเลือกระหว่างโมเดลที่ซับซ้อน แต่มีความแปรปรวน (Variance) ในการทำนายกับข้อมูลที่ไม่เคยเห็นมาก่อน กับ โมเดลที่เรียบง่ายตัดสินใจไม่ซับซ้อน แต่ก็อาจจะโง่เกินไปเพราะอคติ (Bias) ในตัว
<strong>หมายเหตุ:</strong> หากไปคำว่า Bias-variance tradeoff ในอินเตอร์เน็ต จะพบกราฟที่กลับหัวกับกราฟข้างต้น เนื่องจากโดยปกติมักจะแสดงแกนตั้งด้วยค่า Error ของการทำนาย แทนที่จะเป็นค่า Accuracy อย่างเช่นที่แสดงให้นักศึกษาเห็น</p>
</div></blockquote>
<blockquote>
<div><p>Decision tree มีค่าต่าง ๆ มากมายที่ต้องกำหนดเอง ได้แก่ <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> ที่ได้ทดลองปรับเองจากหัวข้อก่อนหน้า เราเรียกค่าที่เราต้องกำหนดเอง โดยที่โมเดลไม่ได้เรียนรู้จากข้อมูลนี้ว่า <strong>hyper-parameter ของโมเดล</strong> เพื่อไม่ให้สับสนกับ <strong>parameter ของโมเดล</strong> ที่ต้องเรียนรู้จากข้อมูล เช่นกฏ <code class="docutils literal notranslate"><span class="pre">persons&lt;=0.5</span></code> ใน Decision tree หรือพารามิเตอร์ <span class="math notranslate nohighlight">\(w\)</span> และ <span class="math notranslate nohighlight">\(b\)</span> ของ Linear/Logistic regression</p>
</div></blockquote>
<p><strong>คำถาม:</strong></p>
<ol class="arabic simple">
<li><p>โมเดลอื่น ๆ นอกจาก Decision tree เกิดปัญหา overfit/underfit ได้ด้วยหรือไม่?</p></li>
</ol>
<ul class="simple">
<li><p><strong>ตอบ:</strong> มีเช่นกัน</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>จากกราฟ เราควรเลือกค่า <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> ที่ค่าเท่าไรดีล่ะ?</p></li>
</ol>
<ul class="simple">
<li><p><strong>ตอบ:</strong> ควรเลือก <code class="docutils literal notranslate"><span class="pre">max_depth=8</span></code> เพราะดูเป็นจุดที่เป็นทางสายกลาง เพราะจำนวนชั้นของกฎต้นไม้ไม่มากหรือน้อยเกินไป ซึ่งถ้ากล่าวตามจริง โดยทั่วไป เราแคร์ที่โมเดลจะทำนายได้ดีกับข้อมูลที่ไม่เคยเห็น (test set)</p></li>
</ul>
<ol class="arabic simple" start="3">
<li><p>จากคำถามข้อ 2. สิ่งที่เราทำจนกว่าจะได้ค่า <code class="docutils literal notranslate"><span class="pre">max_depth=8</span></code> คือ ลองเทรน <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> ที่ค่าต่าง ๆ กับข้อมูล <code class="docutils literal notranslate"><span class="pre">X_train</span></code> แล้วเอามาทดสอบกับข้อมูล <code class="docutils literal notranslate"><span class="pre">X_test</span></code> จนกว่าจะพบ <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> ที่มีประสิทธิภาพกับ <code class="docutils literal notranslate"><span class="pre">X_test</span></code> ดีที่สุด นักศึกษาคิดว่า จริง ๆ <strong>มันแฟร์หรือไม่</strong>ที่จะบอกว่า <code class="docutils literal notranslate"><span class="pre">max_depth=8</span></code> ที่พบนั้นดีจริง ๆ <strong>และเพราะอะไร</strong></p></li>
</ol>
<ul class="simple">
<li><p><strong>ตอบ:</strong> ไม่แฟร์เลย เพราะเท่ากับว่าเราใช้ <code class="docutils literal notranslate"><span class="pre">X_test</span></code> ในการ tune หาค่า <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> ซึ่งสุดท้ายแล้วจะเกิดปัญหา overfit กับค่า <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> เองก็เป็นได้ กล่าวคือโมเดลที่เทรนด้วยค่า <code class="docutils literal notranslate"><span class="pre">max_depth=8</span></code> อาจจะใช้ไม่ได้กับข้อมูลอื่น ๆ  ในความเป็นจริง <code class="docutils literal notranslate"><span class="pre">X_test</span></code> เป็นข้อมูลที่ไม่ควรถูกแตะต้องในกระบวนการสอนโมเดล ซึ่งวิธีการแก้ไขคือ เราควรมีข้อมูล 3 กลุ่ม แทนที่จะมีแค่ 2 กลุ่ม (train/test) เหมือนที่เราทำที่ผ่านมา โดยหน้าที่ของข้อมูล 3 กลุ่มนี้ คือ</p>
<ul>
<li><p><strong>Training set</strong> - ใช้ฝึกสอนโมเดล (เหมือนกับ Training set เดิม)</p></li>
<li><p><strong>Validation set</strong> - ใช้ทดสอบประสิทธิภาพของโมเดลในเบื้องต้น เพื่อปรับจูนค่า hyper-parameter ต่าง ๆ เช่น <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> ซึ่งข้อมูลเซตนี้เป็นเซตใหม่ที่อาจแบ่งมาจาก Training set เดิม</p></li>
<li><p><strong>Blind test set</strong> - เป็นชุดข้อมูลที่เก็บไว้ทดสอบประสิทธิภาพจริง ๆ ในขั้นสุดท้าย</p></li>
</ul>
</li>
</ul>
</section>
<section id="gridsearchcv">
<h2><span class="section-number">8.6. </span>ลองค่าต่าง ๆ ด้วย <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code><a class="headerlink" href="#gridsearchcv" title="Permalink to this heading">#</a></h2>
<p>การปรับค่า hyper-parameter ต่าง ๆ หากจะลองผิดลองถูกทีละค่าก็ไม่สะดวกเท่าไร ดังนั้นจึงมีเครื่องมืออำนวยความสะดวกที่ช่วยทดสอบชุดของค่าเหล่านั้น โดยใช้ <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.GridSearchCV.html">คู่มือ</a> ซึ่งรูปแบบการใช้งาน เป็นการนำ <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> ไปครอบหรือเรียกใช้ตัวโมเดลอีกที ดังรูปแบบต่อไปนี้</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>

<span class="n">cv</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">โมเดล</span><span class="p">,</span> <span class="n">ดิกชันนารีของค่า</span><span class="p">,</span> <span class="n">refit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>โดยเมื่อสร้าง <code class="docutils literal notranslate"><span class="pre">cv</span></code> แล้ว ก็สามารถเรียกใช้ได้เหมือนโมเดลปกติ เช่น</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cv.fit(X_train,</span> <span class="pre">y_train)</span></code> และ</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cv.predict(X_test)</span></code></p></li>
</ul>
<p>ทั้งนี้ <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> จะเลือก hyperparameters ที่ดีที่สุด ที่ต่างจากวิธีการของเราอยู่บ้าง กล่าวคือ <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> จะใช้วิธีการ 5-fold cross validation (โดย default) ดังนี้</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cv.fit(X_train,</span> <span class="pre">y_train)</span></code> สุ่มแบ่งข้อมูล <code class="docutils literal notranslate"><span class="pre">X_train</span></code> เป็น 5 ส่วน (folds) 5 แบบ ดังตาราง</p></li>
</ol>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p></p></th>
<th class="head text-center"><p>Fold 1</p></th>
<th class="head text-center"><p>Fold 2</p></th>
<th class="head text-center"><p>Fold 3</p></th>
<th class="head text-center"><p>Fold 4</p></th>
<th class="head text-center"><p>Fold 5</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p>ข้อมูลสำหรับโมเดล 1</p></td>
<td class="text-center"><p>X</p></td>
<td class="text-center"><p>O</p></td>
<td class="text-center"><p>O</p></td>
<td class="text-center"><p>O</p></td>
<td class="text-center"><p>O</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>ข้อมูลสำหรับโมเดล 2</p></td>
<td class="text-center"><p>O</p></td>
<td class="text-center"><p>X</p></td>
<td class="text-center"><p>O</p></td>
<td class="text-center"><p>O</p></td>
<td class="text-center"><p>O</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>ข้อมูลสำหรับโมเดล 3</p></td>
<td class="text-center"><p>O</p></td>
<td class="text-center"><p>O</p></td>
<td class="text-center"><p>X</p></td>
<td class="text-center"><p>O</p></td>
<td class="text-center"><p>O</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>ข้อมูลสำหรับโมเดล 4</p></td>
<td class="text-center"><p>O</p></td>
<td class="text-center"><p>O</p></td>
<td class="text-center"><p>O</p></td>
<td class="text-center"><p>X</p></td>
<td class="text-center"><p>O</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>ข้อมูลสำหรับโมเดล 5</p></td>
<td class="text-center"><p>O</p></td>
<td class="text-center"><p>O</p></td>
<td class="text-center"><p>O</p></td>
<td class="text-center"><p>O</p></td>
<td class="text-center"><p>X</p></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><p>สร้างโมเดลจากการกำหนด hyper-parameter 1 แบบที่ต้องการลอง เช่น สมมติเลือก <code class="docutils literal notranslate"><span class="pre">max_depth=40,</span> <span class="pre">criterion='gini',</span> <span class="pre">min_samples_split=2</span></code> เป็นต้น</p></li>
<li><p>นำค่าข้อ 2. มาเทรนโมเดล 5 โมเดล โดยแต่ละโมเดลจะเทรนและทดสอบโดยใช้ข้อมูลต่างกันตามตารางข้อ 1 คือ เฉพาะส่วนที่เป็นสัญลักษณ์ O จะเป็น training set และส่วนที่เป็น X จะเป็น validation set (หรือชุดข้อมูลทดสอบในเบื้องต้น)</p></li>
<li><p>นำผลประสิทธิภาพของทั้ง 5 โมเดลมาเฉลี่ยรวม</p></li>
<li><p>กลับไปทำข้อ 2, 3, 4 อีกครั้ง โดยเปลี่ยนไปใช้ hyper-parameter ค่าอื่น จนครบทุกค่าที่ต้องการลอง โดยสุดท้ายแล้ว hyper-parameters ที่ดีที่สุดคือที่ให้ประสิทธิภาพที่วัดในข้อ 4 สูงที่สุด</p></li>
<li><p>เป็นขั้นตอนของการ Refit คือการนำ hyper-parameters ที่ดีที่สุดจากข้อ 5 มาเทรนกับข้อมูลทั้งชุด (<code class="docutils literal notranslate"><span class="pre">X_train</span></code>) (Fold 1 ถึง 5 ทั้งหมด) ซึ่งขั้นตอนนี้ระบุให้ทำด้วยการกำหนด <code class="docutils literal notranslate"><span class="pre">refit=True</span></code></p></li>
</ol>
<p>สำหรับโค้ดตัวอย่างการใช้ <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> ดูได้ตามด้านล่างนี้</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>

<span class="c1"># สร้างโมเดลที่กำหนดค่าไว้บางส่วน</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span>
            <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span>
<span class="p">)</span>

<span class="c1"># List of Dictionary of Hyper-parameters ที่ต้องการทดลองโดย GridSearchCV จะจับคู่กันทุกแบบ</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:[</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">],</span>
    <span class="s1">&#39;criterion&#39;</span><span class="p">:[</span><span class="s1">&#39;gini&#39;</span><span class="p">]}</span>
<span class="p">]</span>

<span class="c1"># สร้าง GridSearchCV เปล่า ๆ ครอบ DecisionTreeClassifier dt อีกที</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">refit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># ฝึกสอน GridSearchCV ซึ่งจะไปสอน dt อีกที ด้วย param_grid ค่าต่าง ๆ</span>
<span class="n">cv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Best hyperparameters are </span><span class="si">{</span><span class="n">cv</span><span class="o">.</span><span class="n">best_params_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># การทำนาย (ใช้ cv ไม่ใช่ dt เพราะค่า hyperparameter ที่ดีที่สุด เก็บไว้ใน cv ไม่ใช่ dt)</span>
<span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>  <span class="c1"># Prediction on training set</span>
<span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>    <span class="c1"># Prediction on test set</span>

<span class="c1"># รายงานผล</span>
<span class="n">acc_train</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
<span class="n">acc_test</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Accuracy: train = </span><span class="si">{</span><span class="n">acc_train</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, test = </span><span class="si">{</span><span class="n">acc_test</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best hyperparameters are {&#39;criterion&#39;: &#39;gini&#39;, &#39;max_depth&#39;: 10}
Accuracy: train = 0.9648, test = 0.9067
</pre></div>
</div>
</div>
</div>
<p>จะเห็นว่า ผลลัพธ์ที่ได้อาจไม่ใช่ค่า <code class="docutils literal notranslate"><span class="pre">max_depth=8</span></code> เดียวกับค่าที่เราคิดว่าดีที่สุด นั่นเป็นเพราะ <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code>แบ่งซอยข้อมูล <code class="docutils literal notranslate"><span class="pre">X_train</span></code> ไปเป็นหลาย validation set แล้วเฉลี่ยผลลัพธ์</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebook"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="lecture06-1.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">7. </span>การแปลงข้อมูล categorical และ ordinal ให้เป็นตัวเลข</p>
      </div>
    </a>
    <a class="right-next"
       href="lecture07.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">9. </span>ปัญหาการจัดกลุ่มลูกค้า</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> สารบัญ
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">8.1. เตรียมข้อมูลให้พร้อม</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decision-tree">8.2. เทรนโมเดล Decision tree</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">8.3. ประเมินประสิทธิภาพของโมเดล</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">8.4. การแปลผลการติดสินใจ</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overfit-underfit">8.5. ปัญหา overfit และ underfit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gridsearchcv">8.6. ลองค่าต่าง ๆ ด้วย <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Kasemsit Teeyapan
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>